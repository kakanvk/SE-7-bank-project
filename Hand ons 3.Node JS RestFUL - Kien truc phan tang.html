<!DOCTYPE html><html><head>
      <title>Hand ons 3.Node JS RestFUL - Kien truc phan tang</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Hoc vien\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.20\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="i-dockerize-·ª©ng-d·ª•ng-restful-api-banking-project-v√†-t√≠ch-h·ª£p-mongodb">I. Dockerize ·ª©ng d·ª•ng RESTful API Banking-Project v√† t√≠ch h·ª£p MongoDB </h1>
<p>ƒê·ªÉ <strong>Dockerize</strong>  ·ª©ng d·ª•ng v√† thay ƒë·ªïi vi·ªác l∆∞u d·ªØ li·ªáu t·ª´ <strong>in-memory</strong>  sang <strong>MongoDB</strong> , ta s·∫Ω l√†m c√°c b∆∞·ªõc sau:</p>
<h2 id="-ki·∫øn-tr√∫c-mongodb--nodejs-api--nginx-frontend">üéØ Ki·∫øn tr√∫c: MongoDB + Node.js (API) + NGINX (Frontend) </h2>
<ul>
<li>
<p><code>MongoDB</code> (port: <code>27170</code>)</p>
</li>
<li>
<p><code>Node.js Backend API</code> (port: <code>5000</code>)</p>
</li>
<li>
<p><code>NGINX</code> ph·ª•c v·ª• frontend (port: <code>3000</code>)</p>
</li>
</ul>
<hr>
<h2 id="-code-s∆°-ƒë·ªì-ki·∫øn-tr√∫c-graphviz-dot-format">‚úÖ Code s∆° ƒë·ªì ki·∫øn tr√∫c (Graphviz DOT format) </h2>
<p class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: docker_architecture Pages: 1 -->
<svg width="922pt" height="107pt" viewBox="0.00 0.00 921.63 107.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 103)">
<title>docker_architecture</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-103 917.63,-103 917.63,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_mongo</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="779.03,-8 779.03,-91 913.63,-91 913.63,-8 779.03,-8"></polygon>
<text text-anchor="middle" x="846.33" y="-74.4" font-family="Times,serif" font-size="14.00">MongoDB Container</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_api</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="520.86,-8 520.86,-91 658.7,-91 658.7,-8 520.86,-8"></polygon>
<text text-anchor="middle" x="589.78" y="-74.4" font-family="Times,serif" font-size="14.00">Node.js API Server</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_frontend</title>
<polygon fill="none" stroke="black" stroke-dasharray="5,2" points="237.44,-8 237.44,-91 391.58,-91 391.58,-8 237.44,-8"></polygon>
<text text-anchor="middle" x="314.51" y="-74.4" font-family="Times,serif" font-size="14.00">NGINX + Frontend</text>
</g>
<!-- mongo -->
<g id="node1" class="node">
<title>mongo</title>
<polygon fill="#f9c74f" stroke="black" points="889.25,-57.8 802.41,-57.8 802.41,-16.2 889.25,-16.2 889.25,-57.8"></polygon>
<text text-anchor="middle" x="845.83" y="-41.2" font-family="Arial" font-size="14.00">MongoDB</text>
<text text-anchor="middle" x="845.83" y="-24.4" font-family="Arial" font-size="14.00">port: 27170</text>
</g>
<!-- api -->
<g id="node2" class="node">
<title>api</title>
<polygon fill="#90be6d" stroke="black" points="650.7,-57.8 528.86,-57.8 528.86,-16.2 650.7,-16.2 650.7,-57.8"></polygon>
<text text-anchor="middle" x="589.78" y="-41.2" font-family="Arial" font-size="14.00">Node.js Backend</text>
<text text-anchor="middle" x="589.78" y="-24.4" font-family="Arial" font-size="14.00">port: 5000</text>
</g>
<!-- api&#45;&gt;mongo -->
<g id="edge3" class="edge">
<title>api-&gt;mongo</title>
<path fill="none" stroke="black" d="M650.99,-37C693.41,-37 749.74,-37 790.74,-37"></path>
<polygon fill="black" stroke="black" points="790.62,-40.5 800.62,-37 790.62,-33.5 790.62,-40.5"></polygon>
<text text-anchor="middle" x="718.87" y="-41.2" font-family="Times,serif" font-size="14.00">Query DB :27170</text>
</g>
<!-- frontend -->
<g id="node3" class="node">
<title>frontend</title>
<polygon fill="#43aa8b" stroke="black" points="383.58,-57.8 245.44,-57.8 245.44,-16.2 383.58,-16.2 383.58,-57.8"></polygon>
<text text-anchor="middle" x="314.51" y="-41.2" font-family="Arial" font-size="14.00">NGINX Web Server</text>
<text text-anchor="middle" x="314.51" y="-24.4" font-family="Arial" font-size="14.00">(port: 3000)</text>
</g>
<!-- frontend&#45;&gt;api -->
<g id="edge2" class="edge">
<title>frontend-&gt;api</title>
<path fill="none" stroke="black" d="M383.76,-37C424.37,-37 475.83,-37 517.04,-37"></path>
<polygon fill="black" stroke="black" points="516.86,-40.5 526.86,-37 516.86,-33.5 516.86,-40.5"></polygon>
<text text-anchor="middle" x="456.22" y="-41.2" font-family="Times,serif" font-size="14.00">Proxy to API :5000</text>
</g>
<!-- user -->
<g id="node4" class="node">
<title>user</title>
<ellipse fill="#577590" stroke="black" cx="69.53" cy="-37" rx="69.53" ry="18"></ellipse>
<text text-anchor="middle" x="69.53" y="-32.8" font-family="Arial" font-size="14.00">User Browser</text>
</g>
<!-- user&#45;&gt;frontend -->
<g id="edge1" class="edge">
<title>user-&gt;frontend</title>
<path fill="none" stroke="black" d="M139.5,-37C168.87,-37 203.29,-37 233.74,-37"></path>
<polygon fill="black" stroke="black" points="233.68,-40.5 243.68,-37 233.68,-33.5 233.68,-40.5"></polygon>
<text text-anchor="middle" x="192.25" y="-41.2" font-family="Times,serif" font-size="14.00">HTTP :3000</text>
</g>
</g>
</svg>
</p><hr>
<h2 id="c√°c-b∆∞·ªõc-ƒë∆∞a-mongodb-v√†o-·ª©ng-d·ª•ng">C√°c b∆∞·ªõc ƒë∆∞a MongoDB v√†o ·ª©ng d·ª•ng </h2>
<h3 id="-1-c√†i-ƒë·∫∑t-th∆∞-vi·ªán-mongodb">üß± 1. C√†i ƒë·∫∑t th∆∞ vi·ªán MongoDB </h3>
<p>Ch·∫°y:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">npm</span> <span class="token function">install</span> mongoose
</code></pre><hr>
<h3 id="--2-s·ª≠a-code-serverjs-ƒë·ªÉ-d√πng-mongodb">üîß  2. S·ª≠a code <code>server.js</code> ƒë·ªÉ d√πng MongoDB </h3>
<p><strong>Thay ƒë·ªïi ch√≠nh:</strong></p>
<ul>
<li>
<p>K·∫øt n·ªëi MongoDB b·∫±ng <code>mongoose</code></p>
</li>
<li>
<p>S·ª≠ d·ª•ng Schema ƒë·ªÉ l∆∞u tr·ªØ <code>Account</code> v√† <code>Transaction</code></p>
</li>
</ul>
<hr>
<h3 id="-c·∫•u-tr√∫c-th∆∞-m·ª•c-g·ª£i-√Ω">üìÅ C·∫•u tr√∫c th∆∞ m·ª•c g·ª£i √Ω </h3>
<pre data-role="codeBlock" data-info="pgsql" class="language-pgsql pgsql"><code>7-bank-project/api
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ server.js
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ Account.js
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ package-lock.json
</code></pre><hr>
<h3 id="-3-modelsaccountjs--ƒë·ªãnh-nghƒ©a-schema-mongodb">üì¶ 3. <code>models/Account.js</code> ‚Äì ƒê·ªãnh nghƒ©a schema MongoDB </h3>
<p>üìÑ <code>models/Account.js</code></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mongoose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> transactionSchema <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">object</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> accountSchema <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">currency</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">balance</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span>
  <span class="token literal-property property">transactions</span><span class="token operator">:</span> <span class="token punctuation">[</span>transactionSchema<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Account</span> <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">'Account'</span><span class="token punctuation">,</span> accountSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">;</span>

</code></pre><hr>
<h3 id="-4-s·ª≠a-ƒë·ªïi-serverjs-ƒë·ªÉ-d√πng-mongodb-thay-v√¨-db">üîÑ 4. S·ª≠a ƒë·ªïi <code>server.js</code> ƒë·ªÉ d√πng MongoDB thay v√¨ <code>db</code> </h3>
<p>üìÑ <code>server.js</code></p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"body-parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"cors"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mongoose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./package.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Account</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./models/Account"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// App constants</span>
<span class="token keyword keyword-const">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">5000</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> apiPrefix <span class="token operator">=</span> <span class="token string">"/api"</span><span class="token punctuation">;</span>

<span class="token comment">// MongoDB connection</span>
mongoose<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">"mongodb://mongo:27017/budget"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"‚úÖ Connected to MongoDB"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword control-flow keyword-catch">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">"MongoDB connection error:"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create Express app</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">http:\/\/(127(\.\d){3}|localhost)</span><span class="token regex-delimiter">/</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">options</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Router setup</span>
<span class="token keyword keyword-const">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Info route</span>
router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token punctuation">.</span><span class="token property-access">version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create account</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts"</span><span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> currency<span class="token punctuation">,</span> description<span class="token punctuation">,</span> balance <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user <span class="token operator">||</span> <span class="token operator">!</span>currency<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Missing parameters"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> exists <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"User already exists"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token punctuation">,</span>
    currency<span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> description <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'s budget</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">balance</span><span class="token operator">:</span> <span class="token keyword keyword-typeof">typeof</span> balance <span class="token operator">===</span> <span class="token string">"number"</span> <span class="token operator">?</span> balance <span class="token operator">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>balance<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">transactions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-await">await</span> acc<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get account</span>
router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">user</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>acc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Nhap sai username roi ong oi"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete account</span>
router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">user</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">deletedCount</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"User does not exist"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">sendStatus</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add transaction</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user/transactions"</span><span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> date<span class="token punctuation">,</span> object<span class="token punctuation">,</span> amount <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> user <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>date <span class="token operator">||</span> <span class="token operator">!</span>object <span class="token operator">||</span> amount <span class="token operator">===</span> <span class="token keyword nil keyword-undefined">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Missing parameters"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>acc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"User does not exist"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> amt <span class="token operator">=</span> <span class="token keyword keyword-typeof">typeof</span> amount <span class="token operator">===</span> <span class="token string">"number"</span> <span class="token operator">?</span> amount <span class="token operator">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>amt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Amount must be a number"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> id <span class="token operator">=</span> crypto
    <span class="token punctuation">.</span><span class="token method function property-access">createHash</span><span class="token punctuation">(</span><span class="token string">"md5"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>date <span class="token operator">+</span> object <span class="token operator">+</span> amt<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">digest</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>acc<span class="token punctuation">.</span><span class="token property-access">transactions</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">tx</span> <span class="token arrow operator">=&gt;</span> tx<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Transaction already exists"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> transaction <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> date<span class="token punctuation">,</span> object<span class="token punctuation">,</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> amt <span class="token punctuation">}</span><span class="token punctuation">;</span>
  acc<span class="token punctuation">.</span><span class="token property-access">transactions</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  acc<span class="token punctuation">.</span><span class="token property-access">balance</span> <span class="token operator">+=</span> amt<span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-await">await</span> acc<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete transaction</span>
router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user/transactions/:id"</span><span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">user</span><span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">user</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>acc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"User does not exist"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> index <span class="token operator">=</span> acc<span class="token punctuation">.</span><span class="token property-access">transactions</span><span class="token punctuation">.</span><span class="token method function property-access">findIndex</span><span class="token punctuation">(</span><span class="token parameter">tx</span> <span class="token arrow operator">=&gt;</span> tx<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Transaction does not exist"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> removed <span class="token operator">=</span> acc<span class="token punctuation">.</span><span class="token property-access">transactions</span><span class="token punctuation">.</span><span class="token method function property-access">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  acc<span class="token punctuation">.</span><span class="token property-access">balance</span> <span class="token operator">-=</span> removed<span class="token punctuation">.</span><span class="token property-access">amount</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-await">await</span> acc<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">sendStatus</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add API prefix</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>apiPrefix<span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start server</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">üöÄ Server listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h3 id="5-dockerize-·ª©ng-d·ª•ng">5. Dockerize ·ª©ng d·ª•ng </h3>
<p>ƒê·ªÉ <strong>Dockerize c·∫£ frontend (HTML tƒ©nh)</strong>  v√† <strong>backend (Node.js)</strong> , ta c·∫ßn t·∫°o:</p>
<ul>
<li>
<p>M·ªôt Dockerfile cho backend trong <code>7-bank-project/api</code></p>
</li>
<li>
<p>M·ªôt Dockerfile cho frontend trong <code>7-bank-project/solution</code></p>
</li>
<li>
<p>M·ªôt file <code>docker-compose.yml</code> t·∫°i th∆∞ m·ª•c g·ªëc <code>7-bank-project</code> ƒë·ªÉ ch·∫°y c·∫£ hai d·ªãch v·ª•</p>
</li>
</ul>
<hr>
<h3 id="-c·∫•u-tr√∫c-th∆∞-m·ª•c">üìÅ C·∫•u tr√∫c th∆∞ m·ª•c: </h3>
<pre data-role="codeBlock" data-info="pgsql" class="language-pgsql pgsql"><code>7-bank-project/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ server.js
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ solution/
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ docker-compose.yml
</code></pre><hr>
<p>üì¶ <code>api/Dockerfile</code> (backend: Node.js)</p>
<pre data-role="codeBlock" data-info="Dockerfile" class="language-dockerfile Dockerfile"><code><span class="token comment"># S·ª≠ d·ª•ng NodeJS base image</span>
<span class="token instruction"><span class="token keyword keyword-FROM">FROM</span> node:18</span>

<span class="token comment"># T·∫°o th∆∞ m·ª•c l√†m vi·ªác</span>
<span class="token instruction"><span class="token keyword keyword-WORKDIR">WORKDIR</span> /usr/src/app</span>

<span class="token comment"># Sao ch√©p package.json tr∆∞·ªõc ƒë·ªÉ c√†i ƒë·∫∑t ph·ª• thu·ªôc</span>
<span class="token instruction"><span class="token keyword keyword-COPY">COPY</span> package*.json ./</span>

<span class="token comment"># C√†i ƒë·∫∑t c√°c ph·ª• thu·ªôc</span>
<span class="token instruction"><span class="token keyword keyword-RUN">RUN</span> npm install</span>

<span class="token comment"># Sao ch√©p to√†n b·ªô m√£ ngu·ªìn v√†o container</span>
<span class="token instruction"><span class="token keyword keyword-COPY">COPY</span> . .</span>

<span class="token comment"># M·ªü port (gi·∫£ s·ª≠ backend ch·∫°y c·ªïng 5000)</span>
<span class="token instruction"><span class="token keyword keyword-EXPOSE">EXPOSE</span> 5000</span>

<span class="token comment"># L·ªánh ch·∫°y ·ª©ng d·ª•ng</span>
<span class="token instruction"><span class="token keyword keyword-CMD">CMD</span> [<span class="token string">"node"</span>, <span class="token string">"server.js"</span>]</span>
</code></pre><hr>
<p>üåê <code>solution/Dockerfile</code> (frontend: HTML tƒ©nh)</p>
<pre data-role="codeBlock" data-info="Dockerfile" class="language-dockerfile Dockerfile"><code><span class="token comment"># S·ª≠ d·ª•ng image nginx ƒë·ªÉ ch·∫°y static website</span>
<span class="token instruction"><span class="token keyword keyword-FROM">FROM</span> nginx:alpine</span>

<span class="token comment"># X√≥a c·∫•u h√¨nh m·∫∑c ƒë·ªãnh c·ªßa nginx</span>
<span class="token instruction"><span class="token keyword keyword-RUN">RUN</span> rm -rf /usr/share/nginx/html/*</span>

<span class="token comment"># Copy file HTML v√†o nginx html folder</span>
<span class="token instruction"><span class="token keyword keyword-COPY">COPY</span> . /usr/share/nginx/html</span>

<span class="token comment"># M·∫∑c ƒë·ªãnh nginx ch·∫°y c·ªïng 80</span>
<span class="token instruction"><span class="token keyword keyword-EXPOSE">EXPOSE</span> 80</span>
</code></pre><hr>
<p>üß± <code>docker-compose.yml</code></p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">app</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./api
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5000:5000"</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PORT=5000
      <span class="token punctuation">-</span> MONGO_URL=mongodb<span class="token punctuation">:</span>//mongo<span class="token punctuation">:</span>27017/mydb  <span class="token comment"># C·∫≠p nh·∫≠t URI n·∫øu backend d√πng Mongo</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mongo

  <span class="token key atrule">mongo</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo<span class="token punctuation">:</span><span class="token number">6</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"27017:27017"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mongo<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/data/db

  <span class="token key atrule">frontend</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./solution
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"8080:80"</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> frontend
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">mongo-data</span><span class="token punctuation">:</span>
</code></pre><hr>
<h3 id="Ô∏è-c√°ch-ch·∫°y">‚ñ∂Ô∏è C√°ch ch·∫°y: </h3>
<p>T·∫°i th∆∞ m·ª•c <code>my-project</code>, b·∫°n ch·∫°y l·ªánh:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span>
</code></pre><hr>
<h2 id="ph√¢n-t√≠ch-ki·∫øn-tr√∫c-·ª©ng-d·ª•ng">Ph√¢n t√≠ch ki·∫øn tr√∫c ·ª©ng d·ª•ng </h2>
<p>üèóÔ∏è <strong>T·ªïng quan ki·∫øn tr√∫c ·ª©ng d·ª•ng</strong><br>
·ª®ng d·ª•ng c·ªßa b·∫°n l√† m·ªôt d·ªãch v·ª• <strong>RESTful API</strong>  ƒë∆°n gi·∫£n ƒë·ªÉ <strong>qu·∫£n l√Ω t√†i kho·∫£n ng∆∞·ªùi d√πng v√† giao d·ªãch t√†i ch√≠nh</strong> , ƒë∆∞·ª£c x√¢y d·ª±ng v·ªõi c√°c th√†nh ph·∫ßn ch√≠nh:</p>
<table>
<thead>
<tr>
<th>Th√†nh ph·∫ßn</th>
<th>C√¥ng ngh·ªá s·ª≠ d·ª•ng</th>
</tr>
</thead>
<tbody>
<tr>
<td>Web Framework</td>
<td>Express.js</td>
</tr>
<tr>
<td>Middleware</td>
<td>body-parser, cors</td>
</tr>
<tr>
<td>C∆° s·ªü d·ªØ li·ªáu</td>
<td>MongoDB (k·∫øt n·ªëi qua mongoose)</td>
</tr>
<tr>
<td>Dockerization</td>
<td>Dockerfile, docker-compose.yml</td>
</tr>
</tbody>
</table>
<hr>
<p>üîÑ <strong>Lu·ªìng ho·∫°t ƒë·ªông ch√≠nh</strong></p>
<ol start="2">
<li><strong>Kh·ªüi ƒë·ªông ·ª©ng d·ª•ng</strong> :</li>
</ol>
<ul>
<li>
<p>Express server kh·ªüi ch·∫°y t·∫°i <code>PORT=5000</code>.</p>
</li>
<li>
<p>K·∫øt n·ªëi MongoDB b·∫±ng <code>mongoose.connect()</code> ƒë·∫øn <code>mongodb://mongo:27017/budget</code>.</p>
</li>
</ul>
<ol start="4">
<li><strong>API Prefix</strong> :</li>
</ol>
<ul>
<li>T·∫•t c·∫£ c√°c route ƒë∆∞·ª£c prefix b·∫±ng <code>/api</code>, v√≠ d·ª•: <code>/api/accounts</code>.</li>
</ul>
<ol start="6">
<li><strong>Qu·∫£n l√Ω t√†i kho·∫£n</strong> :</li>
</ol>
<ul>
<li>
<p><code>POST /api/accounts</code>: T·∫°o m·ªõi t√†i kho·∫£n.</p>
</li>
<li>
<p><code>GET /api/accounts/:user</code>: Truy v·∫•n th√¥ng tin t√†i kho·∫£n.</p>
</li>
<li>
<p><code>DELETE /api/accounts/:user</code>: X√≥a t√†i kho·∫£n.</p>
</li>
</ul>
<ol start="8">
<li><strong>Qu·∫£n l√Ω giao d·ªãch t√†i ch√≠nh</strong> :</li>
</ol>
<ul>
<li>
<p><code>POST /api/accounts/:user/transactions</code>: Th√™m giao d·ªãch (transaction).</p>
</li>
<li>
<p><code>DELETE /api/accounts/:user/transactions/:id</code>: X√≥a giao d·ªãch.</p>
</li>
</ul>
<hr>
<p>üß± <strong>Ki·∫øn tr√∫c l·ªõp (ƒë∆°n gi·∫£n)</strong></p>
<table>
<thead>
<tr>
<th>L·ªõp</th>
<th>Vai tr√≤</th>
</tr>
</thead>
<tbody>
<tr>
<td>server.js</td>
<td>Entry point, ƒë·ªãnh nghƒ©a routes, x·ª≠ l√Ω logic ·ª©ng d·ª•ng</td>
</tr>
<tr>
<td>models/account.js</td>
<td>Ch·ª©a schema Mongoose cho Account model</td>
</tr>
</tbody>
</table>
<p>·ª®ng d·ª•ng ch∆∞a chia ri√™ng c√°c <strong>layer</strong>  nh∆∞ <code>service</code>, <code>controller</code>, <code>repository</code>, n√™n logic c√≤n n·∫±m t·∫≠p trung trong <code>server.js</code>.</p>
<hr>
<p>üß† **M√¥ h√¨nh d·ªØ li·ªáu **</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token maybe-class-name">Account</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">currency</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">balance</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span>
  <span class="token literal-property property">transactions</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
      <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
      <span class="token literal-property property">object</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
      <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><hr>
<p>üîó <strong>Ki·∫øn tr√∫c k·∫øt n·ªëi d·ªãch v·ª• (trong Docker)</strong></p>
<pre data-role="codeBlock" data-info="plaintext" class="language-plaintext plaintext"><code>[ MongoDB Container ]
              ‚Üë
              ‚îÇ
     (Mongoose, port 27017)
              ‚îÇ
[ Node.js Backend (Express) ]
              ‚Üë
              ‚îÇ
      (REST API, port 5000)
              ‚Üë
              ‚îÇ
      [ Nginx - port 3000 ]
         serve frontend
</code></pre><ul>
<li>
<p>Backend d√πng hostname <code>mongo</code> ƒë·ªÉ k·∫øt n·ªëi DB v√¨ <code>docker-compose</code> cung c·∫•p s·∫µn DNS n·ªôi b·ªô.</p>
</li>
<li>
<p>Frontend (HTML/JS) s·∫Ω g·ª≠i request ƒë·∫øn <code>http://localhost:5000/api/...</code> ho·∫∑c th√¥ng qua reverse proxy c·ªßa <code>nginx</code>.</p>
</li>
</ul>
<hr>
<h1 id="ii-n√¢ng-c·∫•p-ki·∫øn-tr√∫c-s·ª≠-d·ª•ng-mvc--service-layer">II. N√¢ng c·∫•p ki·∫øn tr√∫c s·ª≠ d·ª•ng MVC + Service Layer </h1>
<p>üìå Ta c·∫ßn  thi·∫øt k·∫ø l·∫°i <strong>ki·∫øn tr√∫c ·ª©ng d·ª•ng Node.js + MongoDB</strong>   theo h∆∞·ªõng chu·∫©n h√≥a, r√µ r√†ng h∆°n theo <strong>MVC + Service Layer</strong> , d·ªÖ b·∫£o tr√¨, test v√† m·ªü r·ªông:</p>
<hr>
<p>üß± **Ki·∫øn tr√∫c chu·∫©n h√≥a **</p>
<pre data-role="codeBlock" data-info="perl" class="language-perl perl"><code><span class="token keyword keyword-my">my</span><span class="token operator">-</span>project<span class="token operator">/</span>
‚îú‚îÄ‚îÄ api<span class="token operator">/</span>                      <span class="token comment"># Backend</span>
‚îÇ   ‚îú‚îÄ‚îÄ server<span class="token operator">.</span>js             <span class="token comment"># ƒêi·ªÉm v√†o ch√≠nh c·ªßa ·ª©ng d·ª•ng</span>
‚îÇ   ‚îú‚îÄ‚îÄ config<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db<span class="token operator">.</span>js             <span class="token comment"># K·∫øt n·ªëi MongoDB</span>
‚îÇ   ‚îú‚îÄ‚îÄ models<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account<span class="token operator">.</span>model<span class="token operator">.</span>js  <span class="token comment"># Mongoose model</span>
‚îÇ   ‚îú‚îÄ‚îÄ controllers<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account<span class="token operator">.</span>controller<span class="token operator">.</span>js <span class="token comment"># X·ª≠ l√Ω HTTP request</span>
‚îÇ   ‚îú‚îÄ‚îÄ services<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account<span class="token operator">.</span>service<span class="token operator">.</span>js    <span class="token comment"># Logic nghi·ªáp v·ª•</span>
‚îÇ   ‚îú‚îÄ‚îÄ routes<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account<span class="token operator">.</span>routes<span class="token operator">.</span>js     <span class="token comment"># Khai b√°o routes</span>
‚îÇ   ‚îî‚îÄ‚îÄ middlewares<span class="token operator">/</span>         <span class="token comment"># (T√πy ch·ªçn) x·ª≠ l√Ω l·ªói, auth</span>
‚îÇ       ‚îî‚îÄ‚îÄ errorHandler<span class="token operator">.</span>js
‚îú‚îÄ‚îÄ solution<span class="token operator">/</span>                <span class="token comment"># Frontend tƒ©nh (HTML/CSS/JS)</span>
‚îÇ   ‚îî‚îÄ‚îÄ index<span class="token operator">.</span>html
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker<span class="token operator">-</span>compose<span class="token operator">.</span>yml
‚îî‚îÄ‚îÄ <span class="token keyword keyword-package">package</span><span class="token operator">.</span>json
</code></pre><hr>
<h2 id="-gi·∫£i-th√≠ch-chi-ti·∫øt-vai-tr√≤-c√°c-ph·∫ßn">üìÇ Gi·∫£i th√≠ch chi ti·∫øt vai tr√≤ c√°c ph·∫ßn </h2>
<ol>
<li><code>server.js</code> ‚Äì Kh·ªüi t·∫°o ·ª©ng d·ª•ng ph√≠a backend:</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"cors"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"body-parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> connectDB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./config/db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> accountRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./routes/account.routes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./package.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Init app</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">5000</span><span class="token punctuation">;</span>

<span class="token comment">// Connect DB</span>
<span class="token function">connectDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Middleware</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">http:\/\/(localhost|127\.0\.0\.1)</span><span class="token regex-delimiter">/</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Routes</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token punctuation">.</span><span class="token property-access">version</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> accountRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start server</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">üöÄ Server listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<ol start="2">
<li><code>config/db.js</code> ‚Äì c·∫•u h√¨nh k·∫øt n·ªëi MongoDB</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mongoose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">connectDB</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-await">await</span> mongoose<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">"mongodb://mongo:27017/budget"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"‚úÖ Connected to MongoDB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">"‚ùå MongoDB connection error:"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token method function property-access">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> connectDB<span class="token punctuation">;</span>

</code></pre><hr>
<ol start="3">
<li><code>models/account.model.js</code> ‚Äì ƒë·ªãnh nghƒ©a schema</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mongoose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> transactionSchema <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">object</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> accountSchema <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">currency</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">balance</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span>
  <span class="token literal-property property">transactions</span><span class="token operator">:</span> <span class="token punctuation">[</span>transactionSchema<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Account</span> <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">'Account'</span><span class="token punctuation">,</span> accountSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">;</span>


</code></pre><hr>
<ol start="4">
<li><code>services/account.service.js</code> ‚Äì x·ª≠ l√Ω logic nghi·ªáp v·ª•</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Account</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../models/account.model"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">createAccount</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user<span class="token punctuation">,</span> currency<span class="token punctuation">,</span> description<span class="token punctuation">,</span> balance <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> exists <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>exists<span class="token punctuation">)</span> <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"User already exists"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token punctuation">,</span>
    currency<span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> description <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'s budget</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">balance</span><span class="token operator">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>balance<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">transactions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-return">return</span> acc<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">getAccount</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">deleteAccount</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">addTransaction</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> <span class="token punctuation">{</span> date<span class="token punctuation">,</span> object<span class="token punctuation">,</span> amount <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>acc<span class="token punctuation">)</span> <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"User not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-const">const</span> amt <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>amt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Invalid amount"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-const">const</span> id <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token method function property-access">createHash</span><span class="token punctuation">(</span><span class="token string">"md5"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span>date <span class="token operator">+</span> object <span class="token operator">+</span> amt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">digest</span><span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>acc<span class="token punctuation">.</span><span class="token property-access">transactions</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> tx<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Transaction already exists"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> transaction <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> date<span class="token punctuation">,</span> object<span class="token punctuation">,</span> <span class="token literal-property property">amount</span><span class="token operator">:</span> amt <span class="token punctuation">}</span><span class="token punctuation">;</span>
  acc<span class="token punctuation">.</span><span class="token property-access">transactions</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  acc<span class="token punctuation">.</span><span class="token property-access">balance</span> <span class="token operator">+=</span> amt<span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-await">await</span> acc<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> transaction<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">deleteTransaction</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>acc<span class="token punctuation">)</span> <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"User not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-const">const</span> index <span class="token operator">=</span> acc<span class="token punctuation">.</span><span class="token property-access">transactions</span><span class="token punctuation">.</span><span class="token method function property-access">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tx</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> tx<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Transaction not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword keyword-const">const</span> <span class="token punctuation">[</span>removed<span class="token punctuation">]</span> <span class="token operator">=</span> acc<span class="token punctuation">.</span><span class="token property-access">transactions</span><span class="token punctuation">.</span><span class="token method function property-access">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  acc<span class="token punctuation">.</span><span class="token property-access">balance</span> <span class="token operator">-=</span> removed<span class="token punctuation">.</span><span class="token property-access">amount</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-await">await</span> acc<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  createAccount<span class="token punctuation">,</span>
  getAccount<span class="token punctuation">,</span>
  deleteAccount<span class="token punctuation">,</span>
  addTransaction<span class="token punctuation">,</span>
  deleteTransaction<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<ol start="5">
<li><code>controllers/account.controller.js</code> ‚Äì x·ª≠ l√Ω request/response</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> service <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../services/account.service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">create</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> service<span class="token punctuation">.</span><span class="token method function property-access">createAccount</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> err<span class="token punctuation">.</span><span class="token property-access">message</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">get</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> acc <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> service<span class="token punctuation">.</span><span class="token method function property-access">getAccount</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>acc<span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"User not found"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">delete</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> result <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> service<span class="token punctuation">.</span><span class="token method function property-access">deleteAccount</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token property-access">deletedCount</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"User not found"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">sendStatus</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">addTransaction</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> tx <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> service<span class="token punctuation">.</span><span class="token method function property-access">addTransaction</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> err<span class="token punctuation">.</span><span class="token property-access">message</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">deleteTransaction</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-await">await</span> service<span class="token punctuation">.</span><span class="token method function property-access">deleteTransaction</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">user</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">sendStatus</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> err<span class="token punctuation">.</span><span class="token property-access">message</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<ol start="6">
<li><code>routes/account.routes.js</code> ‚Äì ƒë·ªãnh nghƒ©a API</li>
</ol>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../controllers/account.controller"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts"</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span><span class="token property-access">create</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span><span class="token property-access">get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span><span class="token property-access">delete</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user/transactions"</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span><span class="token property-access">addTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user/transactions/:id"</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span><span class="token property-access">deleteTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="-dockerize-·ª©ng-d·ª•ng">üîß Dockerize ·ª©ng d·ª•ng </h2>
<p>SV t·ª± vi·∫øt</p>
<hr>
<h2 id="-l·ª£i-√≠ch-c·ªßa-ki·∫øn-tr√∫c-chu·∫©n-h√≥a">‚úÖ L·ª£i √≠ch c·ªßa ki·∫øn tr√∫c chu·∫©n h√≥a </h2>
<ul>
<li>
<p>‚úÖ D·ªÖ <strong>qu·∫£n l√Ω m√£ ngu·ªìn</strong></p>
</li>
<li>
<p>‚úÖ T√°ch bi·ªát r√µ <strong>logic, d·ªØ li·ªáu v√† controller</strong></p>
</li>
<li>
<p>‚úÖ Thu·∫≠n ti·ªán <strong>unit test t·ª´ng l·ªõp</strong></p>
</li>
<li>
<p>‚úÖ D·ªÖ m·ªü r·ªông, b·∫£o tr√¨</p>
</li>
<li>
<p>‚úÖ C√≥ th·ªÉ t√≠ch h·ª£p <strong>middleware</strong> , logging, JWT, swagger d·ªÖ d√†ng</p>
</li>
</ul>
<hr>
<p class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: BackendStructure Pages: 1 -->
<svg width="1238pt" height="287pt" viewBox="0.00 0.00 1238.46 287.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 283)">
<title>BackendStructure</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-283 1234.46,-283 1234.46,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_api</title>
<path fill="none" stroke="lightblue" d="M229.6,-115C229.6,-115 1210.46,-115 1210.46,-115 1216.46,-115 1222.46,-121 1222.46,-127 1222.46,-127 1222.46,-259 1222.46,-259 1222.46,-265 1216.46,-271 1210.46,-271 1210.46,-271 229.6,-271 229.6,-271 223.6,-271 217.6,-265 217.6,-259 217.6,-259 217.6,-127 217.6,-127 217.6,-121 223.6,-115 229.6,-115"></path>
<text text-anchor="middle" x="720.03" y="-254.4" font-family="Times,serif" font-size="14.00">api/</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_solution</title>
<path fill="none" stroke="orange" d="M377.43,-30C377.43,-30 663.88,-30 663.88,-30 669.88,-30 675.88,-36 675.88,-42 675.88,-42 675.88,-95 675.88,-95 675.88,-101 669.88,-107 663.88,-107 663.88,-107 377.43,-107 377.43,-107 371.43,-107 365.43,-101 365.43,-95 365.43,-95 365.43,-42 365.43,-42 365.43,-36 371.43,-30 377.43,-30"></path>
<text text-anchor="middle" x="520.66" y="-90.4" font-family="Times,serif" font-size="14.00">solution/</text>
</g>
<!-- server -->
<g id="node1" class="node">
<title>server</title>
<polygon fill="white" stroke="black" points="436.88,-159 379.84,-159 379.84,-123 442.88,-123 442.88,-153 436.88,-159"></polygon>
<polyline fill="none" stroke="black" points="436.88,-159 436.88,-153"></polyline>
<polyline fill="none" stroke="black" points="442.88,-153 436.88,-153"></polyline>
<text text-anchor="middle" x="411.36" y="-136.8" font-family="Times,serif" font-size="14.00">server.js</text>
</g>
<!-- config -->
<g id="node2" class="node">
<title>config</title>
<polygon fill="lightgray" stroke="black" points="749.11,-159 746.11,-163 725.11,-163 722.11,-159 693.45,-159 693.45,-123 749.11,-123 749.11,-159"></polygon>
<text text-anchor="middle" x="721.28" y="-136.8" font-family="Times,serif" font-size="14.00">config/</text>
</g>
<!-- server&#45;&gt;config -->
<g id="edge1" class="edge">
<title>server-&gt;config</title>
<path fill="none" stroke="black" d="M443.14,-139.15C451.01,-138.76 459.46,-138.4 467.29,-138.2 559.97,-135.84 583.2,-136.58 675.88,-139 677.79,-139.05 679.74,-139.11 681.72,-139.17"></path>
<polygon fill="black" stroke="black" points="681.41,-142.67 691.54,-139.55 681.68,-135.67 681.41,-142.67"></polygon>
<text text-anchor="middle" x="516.66" y="-142.4" font-family="Times,serif" font-size="14.00">uses</text>
</g>
<!-- routes -->
<g id="node6" class="node">
<title>routes</title>
<polygon fill="lightgray" stroke="black" points="656.79,-184 653.79,-188 632.79,-188 629.79,-184 602.69,-184 602.69,-148 656.79,-148 656.79,-184"></polygon>
<text text-anchor="middle" x="629.74" y="-161.8" font-family="Times,serif" font-size="14.00">routes/</text>
</g>
<!-- server&#45;&gt;routes -->
<g id="edge2" class="edge">
<title>server-&gt;routes</title>
<path fill="none" stroke="black" d="M443.35,-152.79C451.06,-155.27 459.39,-157.56 467.29,-159 509.08,-166.61 557.91,-167.66 590.84,-167.26"></path>
<polygon fill="black" stroke="black" points="590.76,-170.76 600.7,-167.08 590.63,-163.76 590.76,-170.76"></polygon>
<text text-anchor="middle" x="516.66" y="-171.4" font-family="Times,serif" font-size="14.00">mounts</text>
</g>
<!-- middlewares -->
<g id="node7" class="node">
<title>middlewares</title>
<polygon fill="lightgray" stroke="black" points="675.45,-238 672.45,-242 651.45,-242 648.45,-238 584.03,-238 584.03,-202 675.45,-202 675.45,-238"></polygon>
<text text-anchor="middle" x="629.74" y="-215.8" font-family="Times,serif" font-size="14.00">middlewares/</text>
</g>
<!-- server&#45;&gt;middlewares -->
<g id="edge3" class="edge">
<title>server-&gt;middlewares</title>
<path fill="none" stroke="black" d="M428.98,-159.24C439.1,-169.24 452.83,-180.99 467.29,-188 500.03,-203.89 540.16,-211.89 572.21,-215.91"></path>
<polygon fill="black" stroke="black" points="571.79,-219.39 582.13,-217.05 572.59,-212.43 571.79,-219.39"></polygon>
<text text-anchor="middle" x="516.66" y="-219.13" font-family="Times,serif" font-size="14.00">uses</text>
</g>
<!-- static_front -->
<g id="node9" class="node">
<title>static_front</title>
<polygon fill="white" stroke="black" points="661.88,-74 591.61,-74 591.61,-38 667.88,-38 667.88,-68 661.88,-74"></polygon>
<polyline fill="none" stroke="black" points="661.88,-74 661.88,-68"></polyline>
<polyline fill="none" stroke="black" points="667.88,-68 661.88,-68"></polyline>
<text text-anchor="middle" x="629.74" y="-51.8" font-family="Times,serif" font-size="14.00">index.html</text>
</g>
<!-- server&#45;&gt;static_front -->
<g id="edge8" class="edge">
<title>server-&gt;static_front</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M434.49,-122.64C444.09,-115.42 455.76,-107.59 467.29,-102.2 508.42,-82.98 522.45,-88.72 566.03,-76 570.79,-74.61 575.73,-73.12 580.66,-71.6"></path>
<polygon fill="black" stroke="black" points="581.42,-75.03 589.92,-68.71 579.33,-68.35 581.42,-75.03"></polygon>
<text text-anchor="middle" x="516.66" y="-106.4" font-family="Times,serif" font-size="14.00">serves</text>
</g>
<!-- models -->
<g id="node3" class="node">
<title>models</title>
<polygon fill="lightgray" stroke="black" points="1214.46,-171 1211.46,-175 1190.46,-175 1187.46,-171 1154.13,-171 1154.13,-135 1214.46,-135 1214.46,-171"></polygon>
<text text-anchor="middle" x="1184.3" y="-148.8" font-family="Times,serif" font-size="14.00">models/</text>
</g>
<!-- config&#45;&gt;models -->
<g id="edge7" class="edge">
<title>config-&gt;models</title>
<path fill="none" stroke="black" d="M749.4,-141.71C826.97,-143.72 1050.09,-149.53 1142.48,-151.94"></path>
<polygon fill="black" stroke="black" points="1142.25,-155.43 1152.34,-152.19 1142.44,-148.44 1142.25,-155.43"></polygon>
<text text-anchor="middle" x="914.83" y="-151.36" font-family="Times,serif" font-size="14.00">connects via db.js</text>
</g>
<!-- controllers -->
<g id="node4" class="node">
<title>controllers</title>
<polygon fill="lightgray" stroke="black" points="846.87,-199 843.87,-203 822.87,-203 819.87,-199 767.11,-199 767.11,-163 846.87,-163 846.87,-199"></polygon>
<text text-anchor="middle" x="806.99" y="-176.8" font-family="Times,serif" font-size="14.00">controllers/</text>
</g>
<!-- services -->
<g id="node5" class="node">
<title>services</title>
<polygon fill="lightgray" stroke="black" points="1047.77,-197 1044.77,-201 1023.77,-201 1020.77,-197 982.79,-197 982.79,-161 1047.77,-161 1047.77,-197"></polygon>
<text text-anchor="middle" x="1015.28" y="-174.8" font-family="Times,serif" font-size="14.00">services/</text>
</g>
<!-- controllers&#45;&gt;services -->
<g id="edge5" class="edge">
<title>controllers-&gt;services</title>
<path fill="none" stroke="black" d="M847.27,-180.62C882.72,-180.28 934.75,-179.77 971.29,-179.42"></path>
<polygon fill="black" stroke="black" points="971.09,-182.92 981.05,-179.32 971.02,-175.92 971.09,-182.92"></polygon>
<text text-anchor="middle" x="914.83" y="-184.61" font-family="Times,serif" font-size="14.00">delegates</text>
</g>
<!-- services&#45;&gt;models -->
<g id="edge6" class="edge">
<title>services-&gt;models</title>
<path fill="none" stroke="black" d="M1048.09,-174.05C1074.99,-169.86 1113.7,-163.83 1142.81,-159.3"></path>
<polygon fill="black" stroke="black" points="1143.01,-162.81 1152.35,-157.82 1141.93,-155.9 1143.01,-162.81"></polygon>
<text text-anchor="middle" x="1100.95" y="-174.79" font-family="Times,serif" font-size="14.00">accesses DB</text>
</g>
<!-- routes&#45;&gt;controllers -->
<g id="edge4" class="edge">
<title>routes-&gt;controllers</title>
<path fill="none" stroke="black" d="M656.98,-168.25C682.92,-170.47 723.27,-173.92 755.45,-176.67"></path>
<polygon fill="black" stroke="black" points="755.12,-180.16 765.39,-177.52 755.72,-173.18 755.12,-180.16"></polygon>
<text text-anchor="middle" x="721.28" y="-179.92" font-family="Times,serif" font-size="14.00">calls</text>
</g>
<!-- docker_api -->
<g id="node8" class="node">
<title>docker_api</title>
<polygon fill="white" stroke="black" points="295.45,-159 225.6,-159 225.6,-123 301.45,-123 301.45,-153 295.45,-159"></polygon>
<polyline fill="none" stroke="black" points="295.45,-159 295.45,-153"></polyline>
<polyline fill="none" stroke="black" points="301.45,-153 295.45,-153"></polyline>
<text text-anchor="middle" x="263.53" y="-136.8" font-family="Times,serif" font-size="14.00">Dockerfile</text>
</g>
<!-- docker_api&#45;&gt;server -->
<g id="edge9" class="edge">
<title>docker_api-&gt;server</title>
<path fill="none" stroke="black" d="M301.7,-141C321.97,-141 347.14,-141 368.14,-141"></path>
<polygon fill="black" stroke="black" points="368.13,-144.5 378.13,-141 368.13,-137.5 368.13,-144.5"></polygon>
<text text-anchor="middle" x="340.65" y="-145.2" font-family="Times,serif" font-size="14.00">RUN</text>
</g>
<!-- docker_front -->
<g id="node10" class="node">
<title>docker_front</title>
<polygon fill="white" stroke="black" points="443.29,-74 373.43,-74 373.43,-38 449.29,-38 449.29,-68 443.29,-74"></polygon>
<polyline fill="none" stroke="black" points="443.29,-74 443.29,-68"></polyline>
<polyline fill="none" stroke="black" points="449.29,-68 443.29,-68"></polyline>
<text text-anchor="middle" x="411.36" y="-51.8" font-family="Times,serif" font-size="14.00">Dockerfile</text>
</g>
<!-- docker_front&#45;&gt;static_front -->
<g id="edge10" class="edge">
<title>docker_front-&gt;static_front</title>
<path fill="none" stroke="black" d="M449.56,-56C485.55,-56 540.32,-56 579.83,-56"></path>
<polygon fill="black" stroke="black" points="579.79,-59.5 589.79,-56 579.79,-52.5 579.79,-59.5"></polygon>
<text text-anchor="middle" x="516.66" y="-60.2" font-family="Times,serif" font-size="14.00">serve via NGINX</text>
</g>
<!-- compose -->
<g id="node11" class="node">
<title>compose</title>
<polygon fill="white" stroke="black" points="127.8,-90 0,-90 0,-54 133.8,-54 133.8,-84 127.8,-90"></polygon>
<polyline fill="none" stroke="black" points="127.8,-90 127.8,-84"></polyline>
<polyline fill="none" stroke="black" points="133.8,-84 127.8,-84"></polyline>
<text text-anchor="middle" x="66.9" y="-67.8" font-family="Times,serif" font-size="14.00">docker-compose.yml</text>
</g>
<!-- compose&#45;&gt;docker_api -->
<g id="edge11" class="edge">
<title>compose-&gt;docker_api</title>
<path fill="none" stroke="black" d="M120.06,-90.49C149.51,-100.93 186.06,-113.89 214.76,-124.07"></path>
<polygon fill="black" stroke="black" points="213.32,-127.27 223.92,-127.31 215.66,-120.67 213.32,-127.27"></polygon>
<text text-anchor="middle" x="176.49" y="-122.88" font-family="Times,serif" font-size="14.00">build api</text>
</g>
<!-- compose&#45;&gt;docker_front -->
<g id="edge12" class="edge">
<title>compose-&gt;docker_front</title>
<path fill="none" stroke="black" d="M133.93,-68.92C200.62,-65.8 302.07,-61.06 361.74,-58.27"></path>
<polygon fill="black" stroke="black" points="361.76,-61.77 371.59,-57.81 361.43,-54.78 361.76,-61.77"></polygon>
<text text-anchor="middle" x="263.53" y="-69" font-family="Times,serif" font-size="14.00">build web</text>
</g>
<!-- pkgjson -->
<g id="node12" class="node">
<title>pkgjson</title>
<polygon fill="white" stroke="black" points="301.87,-36 219.18,-36 219.18,0 307.87,0 307.87,-30 301.87,-36"></polygon>
<polyline fill="none" stroke="black" points="301.87,-36 301.87,-30"></polyline>
<polyline fill="none" stroke="black" points="307.87,-30 301.87,-30"></polyline>
<text text-anchor="middle" x="263.53" y="-13.8" font-family="Times,serif" font-size="14.00">package.json</text>
</g>
<!-- compose&#45;&gt;pkgjson -->
<g id="edge13" class="edge">
<title>compose-&gt;pkgjson</title>
<path fill="none" stroke="black" d="M114.54,-53.52C126.56,-49.13 139.57,-44.71 151.8,-41.2 169.77,-36.05 189.69,-31.52 207.62,-27.86"></path>
<polygon fill="black" stroke="black" points="208.17,-31.32 217.3,-25.94 206.81,-24.46 208.17,-31.32"></polygon>
<text text-anchor="middle" x="176.49" y="-45.4" font-family="Times,serif" font-size="14.00">deps</text>
</g>
</g>
</svg>
</p><h1 id="iii-c√†i-ƒë·∫∑t-swagger-cho-·ª©ng-d·ª•ng">III. C√†i ƒë·∫∑t Swagger cho ·ª©ng d·ª•ng </h1>
<h3 id="1-c√†i-ƒë·∫∑t-swagger-ui-v√†-swagger-jsdoc">1. C√†i ƒë·∫∑t Swagger UI v√† Swagger JSdoc </h3>
<p>ƒê·∫ßu ti√™n, ch√∫ng ta c·∫ßn c√†i ƒë·∫∑t hai g√≥i ch√≠nh ƒë·ªÉ t√≠ch h·ª£p Swagger v√†o ·ª©ng d·ª•ng:</p>
<ul>
<li>
<p><strong>swagger-ui-express</strong> : G√≥i n√†y gi√∫p ch√∫ng ta hi·ªÉn th·ªã Swagger UI trong ·ª©ng d·ª•ng Node.js.</p>
</li>
<li>
<p><strong>swagger-jsdoc</strong> : G√≥i n√†y s·∫Ω t·ª± ƒë·ªông sinh ra t√†i li·ªáu API t·ª´ c√°c comment trong m√£ ngu·ªìn.</p>
</li>
</ul>
<p>Th√™m v√†o <code>package.json</code> c·ªßa b·∫°n trong ph·∫ßn <code>dependencies</code>:</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  
   <span class="token property">"swagger-ui-express"</span><span class="token operator">:</span> <span class="token string">"^4.6.3"</span><span class="token punctuation">,</span>
    <span class="token property">"swagger-jsdoc"</span><span class="token operator">:</span> <span class="token string">"^6.2.8"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><p>Sau ƒë√≥, ch·∫°y l·ªánh <code>npm install</code> ƒë·ªÉ c√†i ƒë·∫∑t c√°c g√≥i.</p>
<h3 id="2-c·∫•u-h√¨nh-swagger-trong-·ª©ng-d·ª•ng-nodejs">2. C·∫•u h√¨nh Swagger trong ·ª©ng d·ª•ng Node.js </h3>
<p>Sau khi c√†i ƒë·∫∑t xong, b·∫°n c·∫ßn c·∫•u h√¨nh Swagger ƒë·ªÉ sinh ra t√†i li·ªáu API t·ª´ c√°c comment trong m√£ ngu·ªìn.</p>
<p>T·∫°o m·ªôt file c·∫•u h√¨nh Swagger  <code>swagger.js</code> trong th∆∞ m·ª•c <code>config</code>:</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// config/swagger.js</span>

<span class="token keyword keyword-const">const</span> swaggerJSDoc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'swagger-jsdoc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">definition</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">openapi</span><span class="token operator">:</span> <span class="token string">'3.0.0'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">info</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'7 Bank Project API'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">'1.0.0'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">'API documentation for 7 Bank Project backend'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">servers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://localhost:5000/api'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">apis</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./routes/*.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ch·ªâ ƒë·ªãnh file ch·ª©a swagger annotations</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> swaggerSpec <span class="token operator">=</span> <span class="token function">swaggerJSDoc</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> swaggerSpec<span class="token punctuation">;</span>

</code></pre><h3 id="3-t·∫°o-c√°c-comment-swagger-cho-c√°c-api">3. T·∫°o c√°c Comment Swagger cho c√°c API </h3>
<p>Trong c√°c file route c·ªßa ·ª©ng d·ª•ng, b·∫°n c·∫ßn th√™m c√°c comment Swagger ƒë·ªÉ m√¥ t·∫£ c√°c API. M·ªói route c·∫ßn ƒë∆∞·ª£c ch√∫ th√≠ch v·ªõi c√°c th√¥ng tin Swagger nh∆∞ m√¥ t·∫£ API, c√°c tham s·ªë ƒë·∫ßu v√†o, v√† c√°c response c√≥ th·ªÉ c√≥.</p>
<h4 id="-routesaccountroutesjs">üîß <code>routes/account.routes.js</code> </h4>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> accountController <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../controllers/account.controller"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts:
 *   post:
 *     summary: T·∫°o t√†i kho·∫£n m·ªõi
 *     tags: [Accounts]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               user:
 *                 type: string
 *               currency:
 *                 type: string
 *               description:
 *                 type: string
 *               balance:
 *                 type: number
 *     responses:
 *       201:
 *         description: T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng
 */</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts"</span><span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">create</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts/<span class="token punctuation">{</span>user<span class="token punctuation">}</span>:
 *   get:
 *     summary: L·∫•y th√¥ng tin t√†i kho·∫£n
 *     tags: [Accounts]
 *     parameters:
 *       - in: path
 *         name: user
 *         required: true
 *         schema:
 *           type: string
 *     responses:
 *       200:
 *         description: Th√¥ng tin t√†i kho·∫£n
 */</span>
router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts/<span class="token punctuation">{</span>user<span class="token punctuation">}</span>:
 *   delete:
 *     summary: X√≥a t√†i kho·∫£n
 *     tags: [Accounts]
 *     parameters:
 *       - in: path
 *         name: user
 *         required: true
 *         schema:
 *           type: string
 *     responses:
 *       204:
 *         description: ƒê√£ x√≥a th√†nh c√¥ng
 */</span>
router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">delete</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts/<span class="token punctuation">{</span>user<span class="token punctuation">}</span>/transactions:
 *   post:
 *     summary: Th√™m giao d·ªãch m·ªõi
 *     tags: [Transactions]
 *     parameters:
 *       - in: path
 *         name: user
 *         required: true
 *         schema:
 *           type: string
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               date:
 *                 type: string
 *               object:
 *                 type: string
 *               amount:
 *                 type: number
 *     responses:
 *       201:
 *         description: Giao d·ªãch ƒë√£ th√™m th√†nh c√¥ng
 */</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user/transactions"</span><span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">addTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts/<span class="token punctuation">{</span>user<span class="token punctuation">}</span>/transactions/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>:
 *   delete:
 *     summary: X√≥a giao d·ªãch
 *     tags: [Transactions]
 *     parameters:
 *       - in: path
 *         name: user
 *         required: true
 *         schema:
 *           type: string
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: string
 *     responses:
 *       204:
 *         description: Giao d·ªãch ƒë√£ ƒë∆∞·ª£c x√≥a
 */</span>
router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user/transactions/:id"</span><span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">deleteTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>




</code></pre><h3 id="4-thi·∫øt-l·∫≠p-swagger-ui">4. Thi·∫øt l·∫≠p Swagger UI </h3>
<p>M·ªü file <code>server.js</code> n∆°i c·∫•u h√¨nh express, t√≠ch h·ª£p Swagger UI v√†o ·ª©ng d·ª•ng:</p>
<h4 id="serverjs"><code>server.js</code> </h4>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code>  <span class="token comment">// </span>

  <span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"cors"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"body-parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> connectDB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./config/db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> accountRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./routes/account.routes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./package.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// üìÑ Swagger:</span>
  <span class="token keyword keyword-const">const</span> swaggerUi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"swagger-ui-express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> swaggerSpec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./config/swagger"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Initialize app</span>
  <span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">5000</span><span class="token punctuation">;</span>

  <span class="token comment">// Connect to MongoDB</span>
  <span class="token function">connectDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Middleware</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">http:\/\/(localhost|127\.0\.0\.1)</span><span class="token regex-delimiter">/</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Swagger API Docs</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">"/api-docs"</span><span class="token punctuation">,</span> swaggerUi<span class="token punctuation">.</span><span class="token property-access">serve</span><span class="token punctuation">,</span> swaggerUi<span class="token punctuation">.</span><span class="token method function property-access">setup</span><span class="token punctuation">(</span>swaggerSpec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Health Check or Base API info</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
      <span class="token literal-property property">version</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span><span class="token property-access">version</span><span class="token punctuation">,</span>
      <span class="token literal-property property">description</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">,</span>
      <span class="token literal-property property">author</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Main API routes</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> accountRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 404 Handler (optional)</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Not Found"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Global Error Handler (optional)</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token property-access">stack</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Internal Server Error"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Start server</span>
  app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">üöÄ Server is running at http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre><p>Khi b·∫°n ch·∫°y ·ª©ng d·ª•ng, Swagger UI s·∫Ω c√≥ s·∫µn t·∫°i <code>http://localhost:5000/api-docs</code>, n∆°i b·∫°n c√≥ th·ªÉ xem t√†i li·ªáu API v√† th·ª≠ nghi·ªám c√°c endpoints tr·ª±c ti·∫øp.</p>
<h3 id="5-ch·∫°y-l·∫°i-docker">5. Ch·∫°y l·∫°i Docker </h3>
<p>Sau khi th√™m Swagger v√†o d·ª± √°n, b·∫°n c·∫ßn rebuild l·∫°i Docker containers ƒë·ªÉ √°p d·ª•ng c√°c thay ƒë·ªïi. Ch·∫°y l·ªánh sau:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">docker-compose</span> down
<span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span>
</code></pre><h3 id="6-ki·ªÉm-tra-api-docs">6. Ki·ªÉm tra API Docs </h3>
<p>Khi ·ª©ng d·ª•ng ƒë√£ ch·∫°y, c√≥ th·ªÉ m·ªü tr√¨nh duy·ªát v√† truy c·∫≠p v√†o Swagger UI t·∫°i <a href="http://localhost:5000/api-docs">http://localhost:5000/api-docs</a> ƒë·ªÉ xem t√†i li·ªáu API. T·∫°i ƒë√¢y, ta c≈©ng c√≥ th·ªÉ th·ª≠ nghi·ªám c√°c API th√¥ng qua giao di·ªán Swagger UI.</p>
<h1 id="iv-nh√∫ng-x√°c-th·ª±c-jwt-v√†o-·ª©ng-d·ª•ng-nodejs">IV. Nh√∫ng X√°c Th·ª±c JWT V√†o ·ª®ng D·ª•ng Node.js </h1>
<p>Trong ph·∫ßn n√†y, ch√∫ng ta s·∫Ω th·ª±c hi·ªán c√°c b∆∞·ªõc sau:</p>
<ol>
<li>
<p>C√†i ƒë·∫∑t c√°c g√≥i c·∫ßn thi·∫øt.</p>
</li>
<li>
<p>C·∫•u h√¨nh JWT v√† c√°c middleware x√°c th·ª±c.</p>
</li>
<li>
<p>Th√™m bi·∫øn m√¥i tr∆∞·ªùng trong <code>.env</code> ƒë·ªÉ b·∫£o m·∫≠t.</p>
</li>
<li>
<p>C·∫≠p nh·∫≠t <code>Dockerfile</code> v√† <code>docker-compose.yml</code> ƒë·ªÉ s·ª≠ d·ª•ng Docker m√† kh√¥ng c·∫ßn ph·∫£i ch·∫°y <code>npm install</code> th·ªß c√¥ng.</p>
</li>
</ol>
<hr>
<h2 id="1-c√†i-ƒë·∫∑t-c√°c-g√≥i-v√†-t·∫°o-c√°c-foldersfiles-c·∫ßn-thi·∫øt"><strong>1. C√†i ƒê·∫∑t C√°c G√≥i v√† T·∫°o C√°c Folders/Files C·∫ßn Thi·∫øt</strong> </h2>
<p>C√°c g√≥i sau s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng trong ·ª©ng d·ª•ng c·ªßa b·∫°n:</p>
<ul>
<li>
<p><strong>bcryptjs</strong> : D√πng ƒë·ªÉ m√£ h√≥a v√† ki·ªÉm tra m·∫≠t kh·∫©u.</p>
</li>
<li>
<p><strong>dotenv</strong> : ƒê·ªÉ s·ª≠ d·ª•ng bi·∫øn m√¥i tr∆∞·ªùng.</p>
</li>
<li>
<p><strong>express</strong> : Framework web cho Node.js.</p>
</li>
<li>
<p><strong>jsonwebtoken</strong> : Th∆∞ vi·ªán t·∫°o v√† x√°c minh JSON Web Tokens.</p>
</li>
<li>
<p><strong>mongoose</strong> : Th∆∞ vi·ªán ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi MongoDB.</p>
</li>
<li>
<p><strong>cors</strong> : D√πng ƒë·ªÉ x·ª≠ l√Ω c√°c y√™u c·∫ßu t·ª´ c√°c ngu·ªìn kh√°c (CORS).</p>
</li>
<li>
<p><strong>body-parser</strong> : D√πng ƒë·ªÉ ph√¢n t√≠ch c√°c y√™u c·∫ßu t·ª´ body.</p>
</li>
<li>
<p><strong>swagger-ui-express</strong> : D√πng ƒë·ªÉ t·∫°o t√†i li·ªáu API v·ªõi Swagger.</p>
</li>
</ul>
<h3 id="c·∫≠p-nh·∫≠t-file-packagejson">C·∫≠p Nh·∫≠t File <code>package.json</code>** </h3>
<p>D∆∞·ªõi ƒë√¢y l√† c√°c g√≥i dependencies cho <code>package.json</code> :</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"body-parser"</span><span class="token operator">:</span> <span class="token string">"^1.20.1"</span><span class="token punctuation">,</span>
    <span class="token property">"cors"</span><span class="token operator">:</span> <span class="token string">"^2.8.5"</span><span class="token punctuation">,</span>
    <span class="token property">"express"</span><span class="token operator">:</span> <span class="token string">"^4.19.2"</span><span class="token punctuation">,</span>    
    <span class="token property">"mongoose"</span><span class="token operator">:</span> <span class="token string">"^8.14.0"</span><span class="token punctuation">,</span>
    <span class="token property">"swagger-ui-express"</span><span class="token operator">:</span> <span class="token string">"^4.6.3"</span><span class="token punctuation">,</span>
    <span class="token property">"swagger-jsdoc"</span><span class="token operator">:</span> <span class="token string">"^6.2.8"</span><span class="token punctuation">,</span>
    <span class="token property">"jsonwebtoken"</span><span class="token operator">:</span> <span class="token string">"^9.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"bcryptjs"</span><span class="token operator">:</span> <span class="token string">"^2.4.3"</span><span class="token punctuation">,</span>
    <span class="token property">"dotenv"</span><span class="token operator">:</span> <span class="token string">"^10.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre><h3 id="b·ªï-sung-c√°c-file-v√†-th∆∞-m·ª•c"><strong>B·ªï sung c√°c file v√† th∆∞ m·ª•c</strong> </h3>
<ul>
<li>T·∫°o th∆∞ m·ª•c <code>auth</code> v√† c√°c file b√™n trong ƒë·ªÉ qu·∫£n l√Ω c√°c API li√™n quan x√°c th·ª±c</li>
<li>T·∫°o file <code>auth.js</code> trong th∆∞ m·ª•c middleware cho ph∆∞∆°ng th·ª©c x√°c th·ª±c</li>
<li>T·∫°o file <code>.env</code> trong th∆∞ m·ª•c g·ªëc c·ªßa d·ª± √°n ƒë·ªÉ l∆∞u bi·∫øn m√¥i tr∆∞·ªùng (kh√≥a b√≠ m·∫≠t)</li>
</ul>
<pre data-role="codeBlock" data-info="perl" class="language-perl perl"><code><span class="token keyword keyword-my">my</span><span class="token operator">-</span>project<span class="token operator">/</span>
‚îú‚îÄ‚îÄ api<span class="token operator">/</span>                          <span class="token comment"># Backend</span>
‚îÇ   ‚îú‚îÄ‚îÄ server<span class="token operator">.</span>js                 <span class="token comment"># ƒêi·ªÉm v√†o ch√≠nh</span>
‚îÇ   ‚îú‚îÄ‚îÄ config<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db<span class="token operator">.</span>js                 <span class="token comment"># K·∫øt n·ªëi MongoDB</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ swagger<span class="token operator">.</span>js           <span class="token comment"># C·∫•u h√¨nh Swagger</span>
‚îÇ   ‚îú‚îÄ‚îÄ models<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account<span class="token operator">.</span>model<span class="token operator">.</span>js      <span class="token comment"># Mongoose model</span>
‚îÇ   ‚îú‚îÄ‚îÄ controllers<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account<span class="token operator">.</span>controller<span class="token operator">.</span>js <span class="token comment"># X·ª≠ l√Ω HTTP request</span>
‚îÇ   ‚îú‚îÄ‚îÄ services<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account<span class="token operator">.</span>service<span class="token operator">.</span>js    <span class="token comment"># Logic nghi·ªáp v·ª•</span>
‚îÇ   ‚îú‚îÄ‚îÄ routes<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ account<span class="token operator">.</span>routes<span class="token operator">.</span>js     <span class="token comment"># Khai b√°o c√°c route li√™n quan ƒë·∫øn account</span>
‚îÇ   ‚îú‚îÄ‚îÄ middlewares<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth<span class="token operator">.</span>js               <span class="token comment"># Middleware x√°c th·ª±c JWT</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ errorHandler<span class="token operator">.</span>js       <span class="token comment"># X·ª≠ l√Ω l·ªói</span>
‚îÇ   ‚îú‚îÄ‚îÄ auth<span class="token operator">/</span>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth<span class="token operator">.</span>controller<span class="token operator">.</span>js    <span class="token comment"># Controller cho auth</span>
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth<span class="token operator">.</span>service<span class="token operator">.</span>js       <span class="token comment"># Business logic cho auth</span>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth<span class="token operator">.</span>routes<span class="token operator">.</span>js        <span class="token comment"># ƒê·ªãnh nghƒ©a c√°c route /auth</span>
‚îú‚îÄ‚îÄ‚îÄ‚îú‚îÄ‚îÄ <span class="token keyword keyword-package">package</span><span class="token operator">.</span>json
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ solution<span class="token operator">/</span>                    <span class="token comment"># Frontend tƒ©nh (HTML/CSS/JS)</span>
‚îÇ   ‚îú‚îÄ‚îÄ index<span class="token operator">.</span>html
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker<span class="token operator">-</span>compose<span class="token operator">.</span>yml
‚îî‚îÄ‚îÄ <span class="token operator">.</span>env                          <span class="token comment"># Bi·∫øn m√¥i tr∆∞·ªùng (v√≠ d·ª•: JWT_SECRET)</span>



</code></pre><h2 id="2-c·∫•u-h√¨nh-m√¥i-tr∆∞·ªùng-v√†-bi·∫øn-jwt_secret">2. C·∫•u H√¨nh M√¥i Tr∆∞·ªùng v√† Bi·∫øn JWT_SECRET </h2>
<p>Trong th∆∞ m·ª•c g·ªëc c·ªßa project, t·∫°o m·ªôt t·ªáp <code>.env</code> ƒë·ªÉ ch·ª©a c√°c bi·∫øn m√¥i tr∆∞·ªùng c·ªßa b·∫°n, bao g·ªìm kh√≥a b√≠ m·∫≠t c·ªßa JWT.<br>
<strong>T·∫°o File <code>.env</code></strong></p>
<pre data-role="codeBlock" data-info="env" class="language-env env"><code>JWT_SECRET=my_super_secret_key_123  # Kh√≥a b√≠ m·∫≠t JWT
</code></pre><h2 id="3-ch·ªânh-s·ª≠a--file-modelsaccountjs-ƒë·ªÉ-b·ªï-sung-thu·ªôc-t√≠nh-password">3. Ch·ªânh s·ª≠a  file <code>models/account.js</code> ƒë·ªÉ b·ªï sung thu·ªôc t√≠nh <code>password</code> </h2>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">//models/account.js</span>

<span class="token keyword keyword-const">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mongoose"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> transactionSchema <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">object</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> accountSchema <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">select</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">currency</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span>
  <span class="token literal-property property">balance</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span>
  <span class="token literal-property property">transactions</span><span class="token operator">:</span> <span class="token punctuation">[</span>transactionSchema<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

accountSchema<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">"toJSON"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">transform</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">doc<span class="token punctuation">,</span> ret</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-delete">delete</span> ret<span class="token punctuation">.</span><span class="token property-access">password</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-return">return</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Account</span> <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">'Account'</span><span class="token punctuation">,</span> accountSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">;</span>

</code></pre><h2 id="4-t·∫°o-x√°c-th·ª±c-jwt-trong-folder-auth">4. T·∫°o X√°c Th·ª±c JWT trong folder <code>auth/</code> </h2>
<h3 id="a-d·ªãch-v·ª•-x√°c-th·ª±c-authauthservicejs">a. D·ªãch v·ª• x√°c th·ª±c <code>auth/auth.service.js</code> </h3>
<p>N·ªôi dung file <code>auth/auth.service.js</code> ƒë·ªÉ x·ª≠ l√Ω vi·ªác ƒëƒÉng k√Ω, ƒëƒÉng nh·∫≠p v√† t·∫°o token JWT.</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">//auth/auth.service.js</span>

<span class="token keyword keyword-const">const</span> bcrypt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"bcryptjs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"jsonwebtoken"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Account</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../models/account"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// D√πng bi·∫øn m√¥i tr∆∞·ªùng cho SECRET_KEY ƒë·ªÉ b·∫£o m·∫≠t</span>
<span class="token keyword keyword-const">const</span> <span class="token constant">SECRET_KEY</span> <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">JWT_SECRET</span> <span class="token operator">||</span> <span class="token string">"default_secret_key"</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> register <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> user<span class="token punctuation">,</span> password<span class="token punctuation">,</span> currency<span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span> balance <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Ki·ªÉm tra user ƒë√£ t·ªìn t·∫°i ch∆∞a</span>
  <span class="token keyword keyword-const">const</span> existing <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>existing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"User already exists"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> hashedPassword <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> bcrypt<span class="token punctuation">.</span><span class="token method function property-access">hash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> account <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> hashedPassword<span class="token punctuation">,</span>
    currency<span class="token punctuation">,</span>
    description<span class="token punctuation">,</span>
    balance<span class="token punctuation">,</span>
    <span class="token literal-property property">transactions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-await">await</span> account<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"User registered successfully"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> user<span class="token punctuation">,</span> password <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// L·∫•y user v√† bao g·ªìm tr∆∞·ªùng password</span>
  <span class="token keyword keyword-const">const</span> account <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">Account</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">"+password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Invalid username or password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> isMatch <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> bcrypt<span class="token punctuation">.</span><span class="token method function property-access">compare</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> account<span class="token punctuation">.</span><span class="token property-access">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Invalid username or password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token method function property-access">sign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">SECRET_KEY</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">"1h"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-return">return</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">verifyToken</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> jwt<span class="token punctuation">.</span><span class="token method function property-access">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span> register<span class="token punctuation">,</span> login<span class="token punctuation">,</span> verifyToken <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><h3 id="b-controller-x√°c-th·ª±c-authauthcontrollerjs">b. Controller x√°c th·ª±c <code>auth/auth.controller.js</code> </h3>
<p>N·ªôi dung file <code>auth/auth.controller.js</code> ƒë·ªÉ ƒëi·ªÅu khi·ªÉn vi·ªác ƒëƒÉng k√Ω, ƒëƒÉng nh·∫≠p.</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">//auth/auth.controller.js</span>

<span class="token keyword keyword-const">const</span> authService <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./auth.service"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">register</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-await">await</span> authService<span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"User registered"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> err<span class="token punctuation">.</span><span class="token property-access">message</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token keyword keyword-async">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> token <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> authService<span class="token punctuation">.</span><span class="token method function property-access">login</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> token <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> err<span class="token punctuation">.</span><span class="token property-access">message</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span> register<span class="token punctuation">,</span> login <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><h3 id="c-routing-x√°c-th·ª±c-authauthroutesjs">c. Routing x√°c th·ª±c <code>auth/auth.routes.js</code> </h3>
<p>N·ªôi dung file <code>auth/auth.routes.js</code> ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng request v·ªÅ ƒëƒÉng k√Ω, ƒëƒÉng nh·∫≠p.</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">//auth/auth.routes.js</span>

<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./auth.controller"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// C√≥ th·ªÉ b·ªï sung Swagger</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/register"</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span><span class="token property-access">register</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span><span class="token property-access">login</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>


</code></pre><h2 id="5-t·∫°o-middleware-x√°c-th·ª±c-jwt"><strong>5. T·∫°o Middleware X√°c Th·ª±c JWT</strong> </h2>
<p>T·∫°o m·ªôt middleware ƒë·ªÉ x√°c minh token JWT trong c√°c y√™u c·∫ßu c·ªßa ng∆∞·ªùi d√πng. ƒê·∫£m b·∫£o r·∫±ng middleware n√†y s·∫Ω ki·ªÉm tra token trong header <code>Authorization</code>.<br>
File <code>auth.js</code> trong <code>middlewares/</code>**</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">//middlewares/auth.js</span>

<span class="token keyword keyword-const">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"jsonwebtoken"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> authHeader <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token punctuation">[</span><span class="token string">"authorization"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"Authorization header:"</span><span class="token punctuation">,</span> authHeader<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Ki·ªÉm tra gi√° tr·ªã header</span>

  <span class="token keyword keyword-const">const</span> token <span class="token operator">=</span> authHeader <span class="token operator">&amp;&amp;</span> authHeader<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Bearer &lt;token&gt;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"Token:"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Ki·ªÉm tra token</span>

  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Token required"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow keyword-try">try</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token method function property-access">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">JWT_SECRET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span><span class="token property-access">user</span> <span class="token operator">=</span> decoded<span class="token punctuation">;</span> <span class="token comment">// G√°n th√¥ng tin ng∆∞·ªùi d√πng v√†o request</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow keyword-catch">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// In l·ªói chi ti·∫øt ra console ƒë·ªÉ ki·ªÉm tra th√™m</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Invalid or expired token"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


</code></pre><h3 id="6-c·∫≠p-nh·∫≠t-routes-ƒë·ªÉ-b·∫£o-v·ªá-c√°c-api">6. C·∫≠p nh·∫≠t routes ƒë·ªÉ b·∫£o v·ªá c√°c API </h3>
<p>ƒê·∫£m b·∫£o r·∫±ng c√°c route y√™u c·∫ßu x√°c th·ª±c ƒë∆∞·ª£c b·∫£o v·ªá b·ªüi middleware x√°c th·ª±c JWT.</p>
<p>Ch·ªânh s·ª≠a <code>routes/account.route.js</code> ƒë·ªÉ b·∫£o v·ªá c√°c API: Th√™m ph∆∞∆°ng th·ª©c x√°c th·ª±c v√†o c√°c router, v√≠ d·ª•</p>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token keyword keyword-const">const</span> auth <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../middlewares/auth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token spread operator">...</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts"</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">create</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><p>N·ªôi dung ƒë·∫ßy ƒë·ªß c·ªßa <code>routes/account.route.js</code></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">//routes/account.route.js</span>

<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> accountController <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../controllers/account.controller"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> auth <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../middlewares/auth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// √Åp d·ª•ng middleware x√°c th·ª±c cho t·∫•t c·∫£ c√°c route b√™n d∆∞·ªõi</span>
<span class="token comment">//router.use(auth);</span>
<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts:
 *   post:
 *     summary: T·∫°o t√†i kho·∫£n m·ªõi
 *     tags: [Accounts]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               user:
 *                 type: string
 *               currency:
 *                 type: string
 *               description:
 *                 type: string
 *               balance:
 *                 type: number
 *     responses:
 *       201:
 *         description: T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng
 */</span>
<span class="token comment">//B·∫£o v·ªá ph∆∞∆°ng th·ª©c POST accounts b·∫±ng auth;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts"</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">create</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts/<span class="token punctuation">{</span>user<span class="token punctuation">}</span>:
 *   get:
 *     summary: L·∫•y th√¥ng tin t√†i kho·∫£n
 *     tags: [Accounts]
 *     parameters:
 *       - in: path
 *         name: user
 *         required: true
 *         schema:
 *           type: string
 *     responses:
 *       200:
 *         description: Th√¥ng tin t√†i kho·∫£n
 */</span>
<span class="token comment">//B·∫£o v·ªá ph∆∞∆°ng th·ª©c GET accounts b·∫±ng auth;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> auth<span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts/<span class="token punctuation">{</span>user<span class="token punctuation">}</span>:
 *   delete:
 *     summary: X√≥a t√†i kho·∫£n
 *     tags: [Accounts]
 *     parameters:
 *       - in: path
 *         name: user
 *         required: true
 *         schema:
 *           type: string
 *     responses:
 *       204:
 *         description: ƒê√£ x√≥a th√†nh c√¥ng
 */</span>
router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user"</span><span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">delete</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts/<span class="token punctuation">{</span>user<span class="token punctuation">}</span>/transactions:
 *   post:
 *     summary: Th√™m giao d·ªãch m·ªõi
 *     tags: [Transactions]
 *     parameters:
 *       - in: path
 *         name: user
 *         required: true
 *         schema:
 *           type: string
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               date:
 *                 type: string
 *               object:
 *                 type: string
 *               amount:
 *                 type: number
 *     responses:
 *       201:
 *         description: Giao d·ªãch ƒë√£ th√™m th√†nh c√¥ng
 */</span>
router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user/transactions"</span><span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">addTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword keyword-@swagger">@swagger</span>
 * /accounts/<span class="token punctuation">{</span>user<span class="token punctuation">}</span>/transactions/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>:
 *   delete:
 *     summary: X√≥a giao d·ªãch
 *     tags: [Transactions]
 *     parameters:
 *       - in: path
 *         name: user
 *         required: true
 *         schema:
 *           type: string
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: string
 *     responses:
 *       204:
 *         description: Giao d·ªãch ƒë√£ ƒë∆∞·ª£c x√≥a
 */</span>
router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">"/accounts/:user/transactions/:id"</span><span class="token punctuation">,</span> accountController<span class="token punctuation">.</span><span class="token property-access">deleteTransaction</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span>

</code></pre><h3 id="7-c·∫≠p-nh·∫≠t-serverjs">7. C·∫≠p nh·∫≠t <code>server.js</code> </h3>
<pre data-role="codeBlock" data-info="js" class="language-javascript js"><code><span class="token comment">// server.js</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"dotenv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"cors"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"body-parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> swaggerUi <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"swagger-ui-express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> connectDB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./config/db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> swaggerSpec <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./config/swagger"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> accountRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./routes/account.routes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> authRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./auth/auth.routes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./package.json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Initialize app</span>
<span class="token keyword keyword-const">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">5000</span><span class="token punctuation">;</span>

<span class="token comment">// Connect to MongoDB</span>
<span class="token function">connectDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Middleware</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">http:\/\/(localhost|127\.0\.0\.1)</span><span class="token regex-delimiter">/</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Swagger API Docs</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">"/api-docs"</span><span class="token punctuation">,</span> swaggerUi<span class="token punctuation">.</span><span class="token property-access">serve</span><span class="token punctuation">,</span> swaggerUi<span class="token punctuation">.</span><span class="token method function property-access">setup</span><span class="token punctuation">(</span>swaggerSpec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// N·∫øu d√πng YAML: app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(require('./docs/swagger.yaml')));</span>

<span class="token comment">// Health Check or Base API info</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span>
    <span class="token literal-property property">version</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span><span class="token property-access">version</span><span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span><span class="token property-access">description</span><span class="token punctuation">,</span>
    <span class="token literal-property property">author</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Main API routes</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> accountRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">"/api/auth"</span><span class="token punctuation">,</span> authRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 404 Handler</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Not Found"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Error Handler</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token property-access">stack</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">"Internal Server Error"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start server</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">üöÄ Server is running at http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre><h3 id="8-c·∫≠p-nh·∫≠t-file-docker-compose">8. C·∫≠p nh·∫≠t file Docker Compose </h3>
<p>C·∫≠p nh·∫≠t file <code>docker-compose.yml</code> ƒë·ªÉ nh·∫≠n bi·∫øn m√¥i tr∆∞·ªùng</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.7"</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">app</span><span class="token punctuation">:</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./api
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"5000:5000"</span>
    <span class="token key atrule">env_file</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> .env  <span class="token comment"># Ch·ªâ ƒë·ªãnh t·ªáp .env m√† Docker s·∫Ω s·ª≠ d·ª•ng</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> PORT=5000
      <span class="token punctuation">-</span> MONGO_URL=mongodb<span class="token punctuation">:</span>//mongo<span class="token punctuation">:</span>27017/mydb  <span class="token comment"># C·∫≠p nh·∫≠t URI n·∫øu backend d√πng Mongo</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mongo
  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mongo<span class="token punctuation">-</span>db
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"27017:27017"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mongo<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/data/db

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">mongo-data</span><span class="token punctuation">:</span>
</code></pre><h3 id="9-build-·ª©ng-d·ª•ng-v√†-ch·∫°y-docker">9. Build ·ª©ng d·ª•ng v√† Ch·∫°y Docker </h3>
<p>S·ª≠ d·ª•ng Docker Compose ƒë·ªÉ x√¢y d·ª±ng v√† ch·∫°y ·ª©ng d·ª•ng.</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">docker-compose</span> up <span class="token parameter variable">--build</span>
</code></pre><hr>
<h3 id="10-test-api-v·ªõi-postman">10. Test API V·ªõi Postman </h3>
<p>ƒê·ªÉ ki·ªÉm tra c√°c API c·ªßa b·∫°n b·∫±ng Postman, h√£y l√†m theo c√°c b∆∞·ªõc sau:</p>
<ol start="2">
<li>
<p>ƒêƒÉng k√Ω ng∆∞·ªùi d√πng qua API <code>POST /api/auth/register</code> v·ªõi body ch·ª©a th√¥ng tin ng∆∞·ªùi d√πng.</p>
</li>
<li>
<p>ƒêƒÉng nh·∫≠p qua API <code>POST /api/auth/login</code> ƒë·ªÉ nh·∫≠n token.</p>
</li>
<li>
<p>S·ª≠ d·ª•ng token trong header <code>Authorization</code> v·ªõi ki·ªÉu Bearer Token khi g·ªçi c√°c API b·∫£o m·∫≠t (v√≠ d·ª•: <code>GET /api/accounts/testuser</code>).</p>
</li>
</ol>
<p>Trong header, ch·ªçn lo·∫°i l√† <strong>Bearer Token</strong>  v√† d√°n token v√†o.</p>
<hr>
<p><strong>K·∫øt Lu·∫≠n</strong><br>
V·ªõi h∆∞·ªõng d·∫´n n√†y, b·∫°n ƒë√£ c√≥ th·ªÉ t√≠ch h·ª£p x√°c th·ª±c JWT v√†o ·ª©ng d·ª•ng Node.js c·ªßa m√¨nh, b·∫£o v·ªá c√°c API b·∫±ng c√°ch s·ª≠ d·ª•ng middleware v√† c·∫•u h√¨nh Docker ƒë·ªÉ t·ª± ƒë·ªông c√†i ƒë·∫∑t ph·ª• thu·ªôc m√† kh√¥ng c·∫ßn ph·∫£i ch·∫°y <code>npm install</code>.</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>